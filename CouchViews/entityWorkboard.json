{"_id":"_design/entityWorkboard","_rev":"5-fb09845ddf7616ebbcafd31b32ee3bf9","views":{"entityWorkboard":{"reduce":"function (keys, values, rereduce) {\r\n  \r\n   var json = {\r\n      expCnt : 0,\r\n      trnCnt : 0,\r\n      settlementCnt : 0,\r\n      E_settlementCnt : 0,\r\n      refundCnt : 0,\r\n      E_refundCnt : 0,\r\n      disputeCnt :0,\r\n      E_disputeCnt : 0,\r\n\t    conflict: 0,\r\n\t    lastSettlementAmount: 0\r\n   }\r\n  \r\n  for (var i=0;i<values.length;i++){\r\n      json.expCnt += values[i].expCnt;\r\n      json.trnCnt += values[i].trnCnt;\r\n      json.settlementCnt += values[i].settlementCnt;\r\n      json.refundCnt += values[i].refundCnt;\r\n      json.disputeCnt += values[i].disputeCnt;\r\n      json.E_settlementCnt +=values[i].E_settlementCnt;\r\n      json.E_refundCnt += values[i].E_refundCnt;\r\n      json.E_disputeCnt += values[i].E_disputeCnt;\r\n\t    json.conflict += values[i].conflict;\r\n\t    json.lastSettlementAmount += values[i].lastSettlementAmount;\r\n  }\r\n  \r\n  return json; \r\n }","map":"function (doc) {\r\n\r\n    var json = {\r\n        expCnt: 0,\r\n        trnCnt: 0,\r\n        settlementCnt: 0,\r\n        E_settlementCnt: 0,\r\n        refundCnt: 0,\r\n        disputeCnt: 0,\r\n        E_refundCnt: 0,\r\n        E_disputeCnt: 0,\r\n        conflict: 0,\r\n        lastSettlementAmount: 0\r\n    }\r\n    var doEmit = false;\r\n    var d = \"\";\r\n    if (doc.data.TimeStamp) {\r\n        var t = new Date(doc.data.TimeStamp * 1000)\r\n        var year = t.getFullYear();\r\n        var mm = t.getMonth() + 1\r\n        mm = mm.toString();\r\n        if (mm.length == 1) {\r\n            mm = \"0\" + mm;\r\n        }\r\n        var dd = t.getDate()\r\n        dd = dd.toString();\r\n        if (dd.length == 1) {\r\n            dd = \"0\" + dd;\r\n        }\r\n        d = year + mm + dd;\r\n        d = parseInt(d)\r\n    }\r\n    if (doc.data.DocumentName == \"Settlement\") {\r\n\t\tif(doc.data.Status  == \"Approved\" || doc.data.Status  == \"Processed\")\r\n\t\t{\r\n\t\t\tlastSettlementAmount = doc.data.ReconciledAmount - doc.data.ExceptionAmount - doc.data.RefundAmount;\r\n\t\t}\r\n\t\r\n\t}\r\n\r\n    if (doc.data.DocumentName == \"ConsolidatedView\") {\r\n\r\n        if (doc.data.ConflictCode.IsAcquirerConflictAmount || doc.data.ConflictCode.IsEntityConflictAmount\r\n            || doc.data.ConflictCode.IsStatusConflict) {\r\n            json.conflict = 1;\r\n\r\n        }\r\n        else {\r\n            var exp = (doc.data.ISException) ? 1 : 0\r\n            var trn = (doc.data.ISException) ? 0 : 1\r\n            json.expCnt = exp;\r\n            json.trnCnt = trn;\r\n        }\r\n        if (doc.data.TimeStamp && doc.data.SPCode) {\r\n            doEmit = true;\r\n        }\r\n    }\r\n    if (doc.data.DocumentName == \"RefundView\") {\r\n        if (doc.data.Status == \"Initiated\") {\r\n            if (doc.data.TimeStamp && doc.data.SPCode) {\r\n                json.refundCnt = 1\r\n                doEmit = true\r\n            }\r\n        }\r\n        if (doc.data.Status == \"Rejected\" || doc.data.Status == \"Processed\") {\r\n            if (doc.data.TimeStamp && doc.data.SPCode) {\r\n                json.E_refundCnt = 1\r\n                doEmit = true\r\n            }\r\n        }\r\n    }\r\n\r\n    if (doc.data.DocumentName == \"DisputeView\") {\r\n        if (doc.data.Status == \"Initiated\") {\r\n            if (doc.data.TimeStamp && doc.data.SPCode) {\r\n                json.disputeCnt = 1\r\n                doEmit = true\r\n            }\r\n        }\r\n        if (doc.data.Status == \"Forwarded\") {\r\n            if (doc.data.TimeStamp && doc.data.SPCode) {\r\n                json.E_disputeCnt = 1\r\n                doEmit = true\r\n            }\r\n        }\r\n    }\r\n\r\n    if (doEmit) {\r\n        emit([doc.data.SPCode, d], json)\r\n    }\r\n}"}},"language":"javascript"}