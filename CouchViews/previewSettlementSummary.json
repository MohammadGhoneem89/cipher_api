{"_id":"_design/previewSettlementSummary","_rev":"1-6e0761ea31088c40a24bb103fe9ecce9","views":{"previewSettlementSummary":{"map":"function (doc) {\r\n    var timestamp = 0;\r\n    var json = {\r\n       count : 0,\r\n       amt : 0.00,\r\n       refundCnt_P : 0,\r\n       refundAmt_P : 0.00,\r\n       refundCnt_UP : 0,\r\n       refundAmt_UP : 0.00\r\n    }\r\n   \r\n    if(doc.data.DocumentName == \"ConsolidatedView\"){\r\n         if (doc.data.RefundSettlementBatchID !=\"\" || doc.data.BatchID !=\"\" || doc.data.ISRFND==true \r\n         || doc.data.ISException==true){\r\n            return\r\n         }\r\n         timestamp = doc.data.TimeStamp\r\n    }\r\n    if(doc.data.DocumentName == \"RefundView\"){\r\n         if (doc.data.BatchID != \"\" || doc.data.Status ==\"Cancelled\") {return};\r\n         timestamp = doc.data.REFUNDINITTS\r\n    }\r\n   \r\n    if (timestamp == 0){ return}\r\n   \r\n    if (doc.data.DocumentName == \"ConsolidatedView\"){\r\n      json.cnt = 1;\r\n      json.amt =doc.data.TotalBillAmount \r\n    }\r\n    \r\n    if (doc.data.DocumentName == \"RefundView\"){\r\n       if (doc.data.Status ==\"Processed\"){\r\n            json.refundCnt_P = 1,\r\n            json.refundAmt_P = doc.data.TotalBillAmount\r\n       }\r\n       else {\r\n            json.refundCnt_UP = 1,\r\n            json.refundAmt_UP = doc.data.TotalBillAmount \r\n       }\r\n       \r\n    }\r\n \r\n    var now = new Date(timestamp * 1000);\r\n    var startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n    timestamp = startOfDay / 1000;\r\n    \r\n    \r\n    \r\n    // please don't change the keys indexes\r\n    var keys = [\r\n      doc.data.SPCode, \r\n      timestamp\r\n      ];\r\n    emit(keys,json);\r\n  \r\n}","reduce":"function (keys, values, rereduce) {\n  \n   var json = {\n       count : 0,\n       amt : 0.00,\n       refundCnt_P : 0,\n       refundAmt_P : 0.00,\n       refundCnt_UP : 0,\n       refundAmt_UP : 0.00\n    }\n  \n  for (var i=0;i<values.length;i++){\n      json.count += values[i].count;\n      json.amt += values[i].amt;\n      json.refundCnt_P += values[i].refundCnt_P;\n      json.refundAmt_P += values[i].refundAmt_P;\n      json.refundCnt_UP += values[i].refundCnt_UP;\n      json.refundAmt_UP += values[i].refundAmt_UP;\n\n  }\n  \n  return json; \n }"}},"language":"javascript"}