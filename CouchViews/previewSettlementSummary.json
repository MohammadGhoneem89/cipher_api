{"_id":"_design/previewSettlementSummary","_rev":"2-b36c068bc4c062e6dce1e622a9266005","views":{"previewSettlementSummary":{"map":"function (doc) {\r\n    var timestamp = 0;\r\n    var json = {\r\n        count : 0,\r\n        amt : 0.00,\r\n        refundCnt_P : 0,\r\n        refundAmt_P : 0.00,\r\n        refundCnt_UP : 0,\r\n        refundAmt_UP : 0.00\r\n    }\r\n\r\n    if(doc.DocumentName == \"ConsolidatedView\"){\r\n        if (doc.RefundSettlementBatchID !=\"\" || doc.BatchID !=\"\" || doc.ISRFND==true\r\n            || doc.ISException==true){\r\n            return\r\n        }\r\n        timestamp = doc.TimeStamp\r\n    }\r\n    if(doc.DocumentName == \"RefundView\"){\r\n        if (doc.BatchID != \"\" || doc.Status ==\"Cancelled\") {return};\r\n        timestamp = doc.REFUNDINITTS\r\n    }\r\n\r\n    if (timestamp == 0){ return}\r\n\r\n    if (doc.DocumentName == \"ConsolidatedView\"){\r\n        json.cnt = 1;\r\n        json.amt =doc.TotalBillAmount\r\n    }\r\n\r\n    if (doc.DocumentName == \"RefundView\"){\r\n        if (doc.Status ==\"Processed\"){\r\n            json.refundCnt_P = 1,\r\n                json.refundAmt_P = doc.TotalBillAmount\r\n        }\r\n        else {\r\n            json.refundCnt_UP = 1,\r\n                json.refundAmt_UP = doc.TotalBillAmount\r\n        }\r\n\r\n    }\r\n\r\n    var now = new Date(timestamp * 1000);\r\n    var startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n    timestamp = startOfDay / 1000;\r\n\r\n\r\n\r\n    // please don't change the keys indexes\r\n    var keys = [\r\n        doc.SPCode,\r\n        timestamp\r\n    ];\r\n    emit(keys,json);\r\n\r\n}","reduce":"\r\nfunction (keys, values, rereduce) {\r\n  var reduceObj = {count :0,amount :0.00}\r\n  for(var j=0;j<values.length;j++){\r\n    reduceObj.count += rereduce ? values[j].count : 1;\r\n    reduceObj.amount +=values[j].amount\r\n  }\r\n   return reduceObj;\r\n}\r\n"}},"language":"javascript"}