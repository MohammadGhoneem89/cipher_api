{"_id":"_design/getCostingReport","_rev":"2-03066e46930bcdbe265a2d231be927c4","views":{"getCostingReport":{"reduce":"\r\nfunction (keys, values, rereduce) {\r\n  var reduceObj = {count :0,amount :0.00}\r\n  for(var j=0;j<values.length;j++){\r\n    reduceObj.count += rereduce ? values[j].count : 1;\r\n    reduceObj.amount +=values[j].amount\r\n  }\r\n   return reduceObj;\r\n}\r\n","map":"function (doc) {\r\n    var json = {\r\n        totalTrans : 0,\r\n        totalAmount : 0,\r\n        totalEntityCommission : 0,\r\n        totalAcquierComission :0\r\n    }\r\n\r\n\r\n\r\n    if (doc.DocumentName == \"Settlement\"){\r\n        var now = new Date(doc.StartDate * 1000);\r\n        var startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n        var timestamp = startOfDay / 1000;\r\n\r\n        json.totalTrans = doc.ReconciledCount + doc.ExceptionCount;\r\n        json.totalAmount = doc.ReconciledAmount + doc.ExceptionAmount\r\n            - doc.RefundAmount;\r\n        json.totalEntityCommission = doc.TotalCommission\r\n        emit ([timestamp,doc.SPCode],json)\r\n\r\n    }\r\n    if (doc.DocumentName == \"ConsolidatedView\"){\r\n        if (doc.CommissionBatchID !=\"\") {\r\n            var now = new Date(doc.TimeStamp * 1000);\r\n            var startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n            var timestamp = startOfDay / 1000;\r\n\r\n            json.totalAcquirerCommission = doc.AcquirerCommissionAmt\r\n            emit ([timestamp,doc.SPCode,doc.EPayStatusAuthRecv],json)\r\n        }\r\n    }\r\n\r\n\r\n}"}},"language":"javascript"}