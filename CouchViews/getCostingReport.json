{"_id":"_design/getCostingReport","_rev":"3-cc30cf3c7fab22d3fbdaab4862e9c343","views":{"getCostingReport":{"reduce":"\r\nfunction (keys, values, rereduce) {\r\n  var reduceObj = {count :0,amount :0.00}\r\n  for(var j=0;j<values.length;j++){\r\n    reduceObj.count += rereduce ? values[j].count : 1;\r\n    reduceObj.amount +=values[j].amount\r\n  }\r\n   return reduceObj;\r\n}\r\n","map":"function (doc) {\n  var json = {\n      totalTrans : 0,\n      totalAmount : 0,\n      totalEntityCommission : 0,\n      totalAcquierComission :0\n  }\n  \n  \n  \n  if (doc.data.DocumentName == \"Settlement\"){\n      var now = new Date(doc.data.StartDate * 1000);\n      var startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n      var timestamp = startOfDay / 1000;\n  \n      json.totalTrans = doc.data.ReconciledCount + doc.data.ExceptionCount;\n      json.totalAmount = doc.data.ReconciledAmount + doc.data.ExceptionAmount \n             - doc.data.RefundAmount;\n      json.totalEntityCommission = doc.data.TotalCommission\n      emit ([timestamp,doc.data.SPCode],json)\n    \n  }\n   if (doc.data.DocumentName == \"ConsolidatedView\"){\n       if (doc.data.CommissionBatchID !=\"\") {\n          var now = new Date(doc.data.TimeStamp * 1000);\n          var startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n          var timestamp = startOfDay / 1000;\n  \n          json.totalAcquirerCommission = doc.data.AcquirerCommissionAmt\n          emit ([timestamp,doc.data.SPCode,doc.data.EPayStatusAuthRecv],json)\n       }\n   }\n  \n  \n}"}},"language":"javascript"}