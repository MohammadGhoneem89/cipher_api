{"_id":"_design/entityReconSummary","_rev":"2-6f802cb6dca1341d3905ffc4a758bfca","views":{"entityReconSummary":{"reduce":"function (keys, values, rereduce) {\r\n  \r\n  var json = {\r\n        disputeCnt : 0,\r\n        refundCnt : 0,\r\n        disputeAmt : 0.00,\r\n        refundAmt  : 0.00\r\n  }\r\n \r\n  for(var i=0;i<values.length;i++){\r\n       json.disputeCnt += values[i].disputeCnt\r\n       json.disputeAmt += values[i].disputeAmt\r\n       json.refundCnt += values[i].refundCnt\r\n       json.refundAmt += values[i].refundAmt\r\n  }\r\n  return json\r\n}","map":"function (doc) {\r\n  if(doc.data.DocumentName === \"ConsolidatedView\"){\r\n    if (doc.data.TimeStamp == 0) return\r\n    var now = new Date(doc.data.TimeStamp * 1000);\r\n    var startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n    var timestamp = startOfDay / 1000;\r\n    var status = \"\";\r\n    if (doc.data.ISFAIL == true) return;\r\n    if (doc.data.ISAUTH  \r\n      && doc.data.ISRECV \r\n      && doc.data.ISINIT \r\n      && doc.data.ISRECN \r\n      && doc.data.ISATHR \r\n      && !doc.data.ISException \r\n      && (doc.data.TotalBillAmount == doc.data.EntityBillAmount)\r\n      && (doc.data.TotalBillAmount == doc.data.AuthorizedAmount)){\r\n        status = \"Complete Match\"\r\n    }\r\n    \r\n    if (status == \"\"\r\n           && doc.data.ISAUTH \r\n            && doc.data.ISRECV \r\n            && doc.data.ISATHR \r\n            && (doc.data.TotalBillAmount == doc.data.AuthorizedAmount)){\r\n        status = \"Match With Bank\"\r\n    }\r\n    \r\n    if (status == \"\" && doc.data.ISINIT && doc.data.ISRECN && \r\n       doc.data.ISRECV && doc.data.ISATHR \r\n        && (doc.data.TotalBillAmount == doc.data.EntityBillAmount) ){\r\n        status = \"Match With SP\"\r\n    }\r\n    if (status ==\"\") return;\r\n    if(doc.data.ISRFND ){status = \"REFUNDED\";}\r\n    var value =  {amount: doc.data.TotalBillAmount,count : 1};\r\n    // please don't change the keys indexes\r\n    var keys = [\r\n      timestamp, \r\n      doc.data.SPCode, \r\n      doc.data.ServiceCode, \r\n      status, \r\n      doc.data.AcquirerId, \r\n      doc.data.PaymentGateway, \r\n      doc.data.PaymentMethod, \r\n      doc.data.CardType,\r\n      doc.data.EPayStatusAuthRecv\r\n      ];\r\n    emit(keys,value);\r\n  }\r\n}"}},"language":"javascript"}