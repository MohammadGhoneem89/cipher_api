{"_id":"_design/entityReconSummary","_rev":"2-85f8136977abaa0c629b663fc2903414","views":{"entityReconSummary":{"reduce":"\r\nfunction (keys, values, rereduce) {\r\n  var reduceObj = {count :0,amount :0.00}\r\n  for(var j=0;j<values.length;j++){\r\n    reduceObj.count += rereduce ? values[j].count : 1;\r\n    reduceObj.amount +=values[j].amount\r\n  }\r\n   return reduceObj;\r\n}\r\n","map":"function (doc) {\r\n    if(doc.DocumentName === \"ConsolidatedView\"){\r\n        if (doc.TimeStamp == 0) return\r\n        var now = new Date(doc.TimeStamp * 1000);\r\n        var startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n        var timestamp = startOfDay / 1000;\r\n        var status = \"\";\r\n        if (doc.ISFAIL == true) return;\r\n        if (doc.ISAUTH\r\n            && doc.ISRECV\r\n            && doc.ISINIT\r\n            && doc.ISRECN\r\n            && doc.ISATHR\r\n            && !doc.ISException\r\n            && (doc.TotalBillAmount == doc.EntityBillAmount)\r\n            && (doc.TotalBillAmount == doc.AuthorizedAmount)){\r\n            status = \"Complete Match\"\r\n        }\r\n\r\n        if (status == \"\"\r\n            && doc.ISAUTH\r\n            && doc.ISRECV\r\n            && doc.ISATHR\r\n            && (doc.TotalBillAmount == doc.AuthorizedAmount)){\r\n            status = \"Match With Bank\"\r\n        }\r\n\r\n        if (status == \"\" && doc.ISINIT && doc.ISRECN &&\r\n            doc.ISRECV && doc.ISATHR\r\n            && (doc.TotalBillAmount == doc.EntityBillAmount) ){\r\n            status = \"Match With SP\"\r\n        }\r\n        if (status ==\"\") return;\r\n        if(doc.ISRFND ){status = \"REFUNDED\";}\r\n        var value =  {amount: doc.TotalBillAmount,count : 1};\r\n        // please don't change the keys indexes\r\n        var keys = [\r\n            timestamp,\r\n            doc.SPCode,\r\n            doc.ServiceCode,\r\n            status,\r\n            doc.AcquirerId,\r\n            doc.PaymentGateway,\r\n            doc.PaymentMethod,\r\n            doc.CardType,\r\n            doc.EPayStatusAuthRecv\r\n        ];\r\n        emit(keys,value);\r\n    }\r\n}"}},"language":"javascript"}