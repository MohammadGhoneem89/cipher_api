{"_id":"_design/acquirerWorkboardByTimestamp","_rev":"3-28be998aca7ac99d2fd1792e85bc697d","views":{"acquirerWorkboardByTimestamp":{"reduce":"function (keys, values, rereduce) {\r\n  \r\n   var json = {\r\n      expCnt : 0,\r\n      trnCnt : 0,\r\n      commissionCnt : 0,\r\n      A_commissionCnt : 0,\r\n      refundCnt : 0,\r\n      disputeCnt :0,\r\n      A_refundCnt : 0,\r\n      A_disputeCnt :0,\r\n\t  conflict: 0,\r\n   }\r\n  \r\n  for (var i=0;i<values.length;i++){\r\n      json.expCnt += values[i].expCnt;\r\n      json.trnCnt += values[i].trnCnt;\r\n      json.commissionCnt += values[i].commissionCnt;\r\n      json.A_commissionCnt += values[i].A_commissionCnt;\r\n      json.refundCnt += values[i].refundCnt;\r\n      json.disputeCnt += values[i].disputeCnt;\r\n      json.A_refundCnt += values[i].A_refundCnt;\r\n      json.A_disputeCnt += values[i].A_disputeCnt;\r\n\t  json.conflict += values[i].conflict;\r\n  }\r\n  \r\n  return json; \r\n }","map":"function (doc) {\r\n  \r\n   var json = {\r\n      expCnt : 0,\r\n      trnCnt : 0,\r\n      commissionCnt : 0,\r\n      A_commissionCnt : 0,\r\n      refundCnt : 0,\r\n      disputeCnt :0,\r\n      A_refundCnt : 0,\r\n      A_disputeCnt :0,\r\n      conflict: 0\r\n   }\r\n   var AcquirerId= \"\";\r\n   var doEmit = false;\r\n   var d = \"\";\r\n   \r\n   \r\n   var docTimeStamp = 0;\r\n   if (doc.data.DocumentName == \"Commission\"){\r\n      docTimeStamp = doc.data.StartDate\r\n      AcquirerId = doc.data.SPCode;\r\n   }\r\n   else {\r\n     docTimeStamp = doc.data.TimeStamp;\r\n     AcquirerId = doc.data.AcquirerId;\r\n   }\r\n   \r\n   \r\n   if (docTimeStamp) {\r\n       var t = new Date(docTimeStamp * 1000)\r\n       var year = t.getFullYear();\r\n       var mm = t.getMonth() + 1\r\n       mm = mm.toString() ;\r\n       if (mm.length==1){\r\n           mm = \"0\"+mm;\r\n       }\r\n       var dd = t.getDate() \r\n       dd = dd.toString();\r\n       if (dd.length==1){\r\n          dd = \"0\"+dd;\r\n       }\r\n       d = year + mm + dd;\r\n       d=parseInt(d)\r\n   }\r\n   \r\n   if(doc.data.DocumentName ==\"ConsolidatedView\"){\r\n       \r\n          if (doc.data.ConflictCode.IsAcquirerConflictAmount || doc.data.ConflictCode.IsEntityConflictAmount\r\n            || doc.data.ConflictCode.IsStatusConflict) {\r\n            json.conflict = 1;\r\n\r\n        }\r\n        else {\r\n            var exp = (doc.data.ISException) ? 1 : 0\r\n            var trn = (doc.data.ISException) ? 0 : 1\r\n            json.expCnt = exp;\r\n            json.trnCnt = trn;\r\n        }\r\n       if (doc.data.TimeStamp && doc.data.AcquirerId){\r\n          doEmit = true;\r\n       }\r\n   }\r\n   if(doc.data.DocumentName == \"RefundView\"){\r\n      if(doc.data.Status ==\"Initiated\" ){\r\n        if (doc.data.TimeStamp && doc.data.AcquirerId){\r\n           json.refundCnt = 1\r\n           doEmit = true\r\n         }\r\n      }\r\n      if(doc.data.Status ==\"Approved\" ){\r\n        if (doc.data.TimeStamp && doc.data.AcquirerId){\r\n           json.A_refundCnt = 1\r\n           doEmit = true\r\n         }\r\n      }\r\n   }\r\n   \r\n   if(doc.data.DocumentName == \"DisputeView\"){\r\n      if(doc.data.Status ==\"Initiated\" ){\r\n        if (doc.data.TimeStamp && doc.data.AcquirerId){\r\n           json.disputeCnt = 1\r\n           doEmit = true\r\n         }\r\n      }\r\n      if(doc.data.Status ==\"Forwarded\" ){\r\n        if (doc.data.TimeStamp && doc.data.AcquirerId){\r\n           json.A_disputeCnt = 1\r\n           doEmit = true\r\n         }\r\n      }\r\n   }\r\n   \r\n   if(doc.data.DocumentName == \"Commission\"){\r\n        if (doc.data.Status == \"Initiated\"){\r\n            if (doc.data.StartDate && doc.data.SPCode){\r\n                 json.commissionCnt = 1\r\n                 doEmit = true\r\n            }  \r\n        }\r\n        if (doc.data.Status == \"Approved\"){\r\n            if (doc.data.TimeStamp && doc.data.SPCode){\r\n                 json.A_commissionCnt = 1\r\n                 doEmit = true\r\n            }  \r\n        }\r\n      \r\n   }   \r\n   \r\n   \r\n   if (doEmit){\r\n      emit([d,AcquirerId], json)\r\n   }\r\n}\r\n"}},"language":"javascript"}