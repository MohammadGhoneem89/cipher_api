{"_id":"_design/acquirerWorkboard","_rev":"2-25b844a20f7e81bf8cb4a3bcb5fb7162","views":{"acquirerWorkboard":{"reduce":"\r\nfunction (keys, values, rereduce) {\r\n  var reduceObj = {count :0,amount :0.00}\r\n  for(var j=0;j<values.length;j++){\r\n    reduceObj.count += rereduce ? values[j].count : 1;\r\n    reduceObj.amount +=values[j].amount\r\n  }\r\n   return reduceObj;\r\n}\r\n","map":"function (doc) {\r\n\r\n    var json = {\r\n        expCnt : 0,\r\n        trnCnt : 0,\r\n        commissionCnt : 0,\r\n        A_commissionCnt : 0,\r\n        refundCnt : 0,\r\n        disputeCnt :0,\r\n        A_refundCnt : 0,\r\n        A_disputeCnt :0,\r\n        conflict: 0\r\n    }\r\n    var doEmit = false;\r\n    var d = \"\";\r\n    var AcquirerId= \"\"\r\n    var docTimeStamp = 0;\r\n    if (doc.DocumentName == \"Commission\"){\r\n        docTimeStamp = doc.StartDate\r\n        AcquirerId = doc.SPCode;\r\n    }\r\n    else {\r\n        docTimeStamp = doc.TimeStamp;\r\n        AcquirerId = doc.AcquirerId;\r\n    }\r\n\r\n    if (docTimeStamp) {\r\n        var t = new Date(docTimeStamp * 1000)\r\n        var year = t.getFullYear();\r\n        var mm = t.getMonth() + 1\r\n        mm = mm.toString() ;\r\n        if (mm.length==1){\r\n            mm = \"0\"+mm;\r\n        }\r\n        var dd = t.getDate()\r\n        dd = dd.toString();\r\n        if (dd.length==1){\r\n            dd = \"0\"+dd;\r\n        }\r\n        d = year + mm + dd;\r\n        d=parseInt(d)\r\n    }\r\n\r\n    if(doc.DocumentName ==\"ConsolidatedView\"){\r\n\r\n        var exp = (doc.ISException) ? 1 : 0\r\n        var trn = (doc.ISException) ? 0 : 1\r\n        json.expCnt = exp;\r\n        json.trnCnt = trn;\r\n        if (doc.ConflictCode.IsAcquirerConflictAmount || doc.ConflictCode.IsEntityConflictAmount\r\n            || doc.ConflictCode.IsStatusConflict) {\r\n            json.conflict = 1;\r\n\r\n        }\r\n        else {\r\n            var exp = (doc.ISException) ? 1 : 0\r\n            var trn = (doc.ISException) ? 0 : 1\r\n            json.expCnt = exp;\r\n            json.trnCnt = trn;\r\n        }\r\n    }\r\n    if(doc.DocumentName == \"RefundView\"){\r\n        if(doc.Status ==\"Initiated\" ){\r\n            if (doc.TimeStamp && doc.AcquirerId){\r\n                json.refundCnt = 1\r\n                doEmit = true\r\n            }\r\n        }\r\n        if(doc.Status ==\"Approved\" ){\r\n            if (doc.TimeStamp && doc.AcquirerId){\r\n                json.A_refundCnt = 1\r\n                doEmit = true\r\n            }\r\n        }\r\n    }\r\n\r\n    if(doc.DocumentName == \"Commission\"){\r\n        if (doc.Status == \"Initiated\"){\r\n            if (doc.StartDate && doc.SPCode){\r\n                json.commissionCnt = 1\r\n                doEmit = true\r\n            }\r\n        }\r\n        if (doc.Status == \"Approved\"){\r\n            if (doc.TimeStamp && doc.SPCode){\r\n                json.A_commissionCnt = 1\r\n                doEmit = true\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    if (doEmit){\r\n        emit([AcquirerId,d], json)\r\n    }\r\n}"}},"language":"javascript"}