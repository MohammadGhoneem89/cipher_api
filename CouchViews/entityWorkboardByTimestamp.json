{"_id":"_design/entityWorkboardByTimestamp","_rev":"3-ab71b0f1cae5d587a768039a18b48f3a","views":{"entityWorkboardByTimestamp":{"reduce":"function (keys, values, rereduce) {\r\n  \r\n   var json = {\r\n      expCnt : 0,\r\n      trnCnt : 0,\r\n      settlementCnt : 0,\r\n      E_settlementCnt : 0,\r\n      refundCnt : 0,\r\n      disputeCnt :0,\r\n      E_refundCnt : 0,\r\n      E_disputeCnt :0,\r\n\t    conflict: 0,\r\n\t    lastSettlementAmount: 0\r\n   }\r\n  \r\n  for (var i=0;i<values.length;i++){\r\n      json.expCnt += values[i].expCnt;\r\n      json.trnCnt += values[i].trnCnt;\r\n      json.settlementCnt += values[i].settlementCnt;\r\n      json.E_settlementCnt += values[i].E_settlementCnt;\r\n      json.refundCnt += values[i].refundCnt;\r\n      json.disputeCnt += values[i].disputeCnt;\r\n      json.E_refundCnt += values[i].E_refundCnt;\r\n      json.E_disputeCnt += values[i].E_disputeCnt;\r\n\t  json.conflict += values[i].conflict;\r\n\t  json.lastSettlementAmount += values[i].lastSettlementAmount;\r\n  }\r\n  \r\n  return json; \r\n }\r\n","map":"function (doc) {\r\n\r\n    var json = {\r\n        expCnt : 0,\r\n        trnCnt : 0,\r\n        settlementCnt : 0,\r\n        E_settlementCnt : 0,\r\n        refundCnt : 0,\r\n        E_refundCnt : 0,\r\n        disputeCnt :0,\r\n        E_disputeCnt : 0,\r\n        conflict : 0,\r\n        lastSettlementAmount: 0\r\n    }\r\n    var doEmit = false;\r\n    var d = \"\";\r\n    var docTimeStamp = 0;\r\n    if (doc.DocumentName == \"Settlement\"){\r\n        docTimeStamp = doc.StartDate\r\n    }\r\n    else {\r\n        docTimeStamp = doc.TimeStamp;\r\n    }\r\n\r\n    if (docTimeStamp) {\r\n        var t = new Date(docTimeStamp * 1000)\r\n        var year = t.getFullYear();\r\n        var mm = t.getMonth() + 1\r\n        mm = mm.toString() ;\r\n        if (mm.length==1){\r\n            mm = \"0\"+mm;\r\n        }\r\n        var dd = t.getDate()\r\n        dd = dd.toString();\r\n        if (dd.length==1){\r\n            dd = \"0\"+dd;\r\n        }\r\n        d = year + mm + dd;\r\n        d=parseInt(d)\r\n    }\r\n    if (doc.DocumentName == \"Settlement\") {\r\n        if(doc.Status  == \"Approved\" || doc.Status  == \"Processed\")\r\n        {\r\n            lastSettlementAmount = doc.ReconciledAmount - doc.ExceptionAmount - doc.RefundAmount;\r\n        }\r\n\r\n    }\r\n\r\n    if(doc.DocumentName ==\"ConsolidatedView\"){\r\n\r\n        if(doc.ConflictCode.IsAcquirerConflictAmount || doc.ConflictCode.IsEntityConflictAmount\r\n            || doc.ConflictCode.IsStatusConflict)\r\n        {\r\n            json.conflict = 1;\r\n\r\n        }\r\n        else\r\n        {\r\n            var exp = (doc.ISException) ? 1 : 0\r\n            var trn = (doc.ISException) ? 0 : 1\r\n            json.expCnt = exp;\r\n            json.trnCnt = trn;\r\n        }\r\n        if (doc.TimeStamp && doc.SPCode){\r\n            doEmit = true;\r\n        }\r\n    }\r\n    if(doc.DocumentName == \"RefundView\"){\r\n        if(doc.Status ==\"Initiated\" ){\r\n            if (doc.TimeStamp && doc.SPCode){\r\n                json.refundCnt = 1\r\n                doEmit = true\r\n            }\r\n        }\r\n        if(doc.Status ==\"Processed\" ||  doc.Status ==\"Rejected\"){\r\n            if (doc.TimeStamp && doc.SPCode){\r\n                json.E_refundCnt = 1\r\n                doEmit = true\r\n            }\r\n        }\r\n    }\r\n\r\n    if(doc.DocumentName == \"Settlement\"){\r\n        if (doc.Status == \"Initiated\"){\r\n            if (doc.StartDate && doc.SPCode){\r\n                json.settlementCnt = 1\r\n                doEmit = true\r\n            }\r\n        }\r\n        if (doc.Status == \"Approved\"){\r\n            if (doc.TimeStamp && doc.SPCode){\r\n                json.E_settlementCnt = 1\r\n                doEmit = true\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    if(doc.DocumentName == \"DisputeView\"){\r\n        if(doc.Status ==\"Initiated\" ){\r\n            if (doc.TimeStamp && doc.SPCode){\r\n                json.disputeCnt = 1\r\n                doEmit = true\r\n            }\r\n        }\r\n        if(doc.Status ==\"Forwarded\" ){\r\n            if (doc.TimeStamp && doc.SPCode){\r\n                json.E_disputeCnt = 1\r\n                doEmit = true\r\n            }\r\n        }\r\n    }\r\n\r\n    if (doEmit){\r\n        emit([d,doc.SPCode], json)\r\n    }\r\n}\r\n"}},"language":"javascript"}